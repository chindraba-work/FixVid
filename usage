#!/bin/bash

########################################################################
#                                                                      #
#  usage: print usage and help information for the FixVid program      #
#                                                                      #
#  This file is part of FixVid, a system to semi-automatically modify  #
#  and re-encode video files to create an acceptable version for a     #
#  standardized collection or library of videos.                       #
#                                                                      #
#  Copyright Â© 2018, 2019  Ronald Lamoreaux <code@chindraba.work>      #
#  - All Rights Reserved                                               #
#                                                                      #
#  FixVid is free software; you can redistribute it and/or             #
#  modify it under the terms of the GNU General Public License,        #
#  version 2 only, as published by the Free Software Foundation.       #
#                                                                      #
#  FixVid is distributed in the hope that it will be useful,           #
#  but WITHOUT ANY WARRANTY; without even the implied warranty of      #
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the       #
#  GNU General Public License for more details.                        #
#                                                                      #
#  You should have received a copy of the GNU General Public License   #
#  along with this program; if not, write to the                       #
#        Free Software Foundation, Inc.                                #
#        51 Franklin Street                                            #
#        Fifth Floor                                                   #
#        Boston, MA  02110-1301                                        #
#        USA.                                                          #
#                                                                      #
########################################################################

# Command script to show the help/usage information for the FixVid
# project
#
# Accepts no arguments
#
# Displays, on STDOUT, the usage data
#
# Generates no files
#

show_usage='cat';
test -n $PAGER && show_usage="$PAGER";

cat <<USAGE | "$show_usage";
Usage: $1 <command> [arg [arg [...] ] ]

Process files in the current directory, according to the information in
the fixvid.conf file as steps in creating a video file from the source
file(s).

Available commands are:

    dts-build
        Create DTS formatted surround sound files from the previously
        created AC3 files from hts-merge.
            Requires: <prefix>-adjusted.ac3
            Skips on: <prefix>-adjusted.dts

    explore <file>
        run ffprobe on the listed file and filter the results, showing
        the lines pertinent to the file's duration, chapter list, and
        each stream located in the file.

    hts-merge
        Combine individual channel files into a single 5.1 surround
        sound soundtrack, saving internal use and external copies of the
        adjusted soundtrack. If any of the needed files are absent,
        will force a run of hts-normalize.
            Requires: <prefix>-surround_e<ch>.wav
            Skips on: <prefix>-surround-adjusted.ac3

    hts-normalize
        Apply normalization filters to each of the 5.1 surround sound
        channel files made by hts-split. The adjusted versions are the
        expected input to hts-merge. If any of the needed files are
        absent, will force a run of hts-split.
            Requires: <prefix>-surround-<ch>.wav
            Skips on: <prefix>-surround-e<ch>.wav

    hts-split
        Extract the 5.1 surround sound soundtrack from the file, save
        the unmodified versions and split the soundtrack into individual
        channel files for further processing via hts-normalize and
        hts-merge.
            Requires: surround_source file
            Skips on: <prefix>-surround-<ch>.wav

    hts-stereo
        Create a stereo soundtrack from the 5.1 surround sound
        soundtrack, save unadjusted versions and adjusted versions of
        the new stereo soundtrack.
            Requires: surround_source file
            Skips on: <prefix>-adjusted.aac

    init
        Create the empty fixvid.conf file in the directory and scan for
        all .mp4, .mkv, and .avi files in the current directory and
        provide a filtered output from ffprobe for each. The scan
        results are displayed, and recorded in the fixvid.scan file.
        Included in the scan is a file named "movie" without any file
        type or extension. This file may be any of the supported types
        and FFMPEG can process it. This file, if present, will be the
        first one scanned, and listed at the top of the scan report.

    subtitles [<group_num>]
        Create subtitle files from the files and streams identified in
        the fixvid.conf file. Will make multiple versions of the
        subtitles if the settings in the config file call for it.
        <group_num> is a number from 1 to whatever, and corresponds to
        the subs_?_x settings in the config file. The numbers must begin
        at 1, and have no gaps in the sequence. The first group of
        settings without a stream will cause the sequence to end prior
        to that number. If fixvid subtitles is called with an argument
        of zero, or no argument, then all the versions will be created,
        otherwise only the version which matches the argument will be
        built, if it is valid in the number sequence.
            Requires: subtitle_source file
            Skips on: <prefix>-subs_<label>.ass (text)
                  OR  <prefix>-subs_<label>.mkv (dvd_subtitle)

    rebuild [<group_num>]
        Create video files from the files and streams identified in the
        fixvid.conf file. Will make multiple versions of the video if
        the settings in the config file call for it. <group_num> is a
        number from 1 to whatever, and corresponds to the video_?_x
        settings in the config file. The numbers must begin at 1, and
        have no gaps in the sequence. The first group of settings
        without a codec will cause the sequence to end prior to that
        number. If fixvid rebuild is called with an argument of zero, or
        no argument, then all the versions will be created, otherwise
        only the version which matches the argument will be built, if it
        is valid in the number sequence.
            Requires: <prefix>-stereo-adjusted.aac
            Skips on: <prefix>-full-<label>.mkv

    stereo
        Extract the stereo sound track from the file and stream
        identified in the fixvid.conf file as the stereo source. Applies
        the enhancements to the stereo sound track and creates an .aac
        and .ac3 file of the original and the enhanced soundtracks.
            Requires: audio_source file
            Skips on: <prefix>-adjusted.aac

    video [<group_num>]
        Extract the video from the file and stream identified in the
        fixvid.conf file. Will make multiple copies of the video if the
        settings in the config file call for it. <group_num> is a number
        from 1 to whatever, and corresponds to the video_?_x settings in
        the config file. The numbers must begin at 1, and have no gaps
        in the sequence. The first group of settings without a codec
        will cause the sequence to end prior to that number. If fixvid
        video is called with an argument of zero, or no argument, then
        all the versions will be extracted, otherwise only the version
        which matches the argument will be built, if it is valid in the
        number sequence.
            Requires: video_source file
            Skips on: <prefix>-video-<label>.mkv

    * The 'Requires' file(s) listed are the files which the command will
        check for and fail to run when missing. The 'Skips on' files are
        the ones which the command will check for and skip running if
        found. To re-run a command the 'Skips on' files are the ones to
        delete before running the command. This allows the creation of a
        script that will run the complete process, and upon checking the
        results it is possible to remove the file(s) which are not up to
        the desired standard. The complete script can then be executed
        again, and FixVid will not waste processing time on the files
        which were not removed, remaking only the ones needed to replace
        those removed. Of course, if one of the component files needs to
        be re-encoded, any file in which that component is included will
        also have to be removed, or it will not be rebuilt with the new
        version of the desired component. At the very least, the full
        video will have to be remuxed for any change in components.

USAGE

if [ 'cat' == $show_usage ]; then
  echo '------------------------------------------------------------------------';
fi

